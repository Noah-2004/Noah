<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accounting Journal</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1976d2">

<style>
body {
    background: #e0e0e0;
    font-family: Arial, sans-serif;
    padding: 20px;
}

/* TABLE */
table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    margin-bottom: 20px;
}

th, td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
}

th {
    background: #f5f5f5;
}

tfoot td {
    font-weight: bold;
}

/* BUTTONS */
button {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.edit { background: orange; color: white; }
.delete { background: crimson; color: white; }
.next { background: #1976d2; color: white; }
.prev { background: gray; color: white; }

#submit {
    background: green;
    color: white;
    width: 100%;
}

#cancel {
    background: darkred;
    color: white;
    width: 100%;
    margin-bottom: 10px;
}

#add-btn {
    background: #1976d2;
    color: white;
    padding: 14px 22px;
    border-radius: 30px;
    display: block;
    margin: 20px auto;
    font-size: 16px;
}

/* FORM */
#input-container {
    display: none;
    background: #ffffff;
    padding: 20px;
    border-radius: 10px;
}

#steps-container {
    overflow: hidden;
}

.steps-wrapper {
    display: flex;
    transition: transform 0.4s ease;
    width: 300%;
}

.step {
    flex: 0 0 100%;
}

input, select {
    width: 100%;
    padding: 12px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
}
</style>
</head>

<body>

<!-- TABLE -->
<table>
<thead>
<tr>
    <th>Date</th>
    <th>Details</th>
    <th>Debit</th>
    <th>Credit</th>
    <th>Actions</th>
</tr>
</thead>

<tbody id="table-body"></tbody>

<tfoot>
<tr>
    <td colspan="2">Totals</td>
    <td id="total-debit">0.00</td>
    <td id="total-credit">0.00</td>
    <td></td>
</tr>
</tfoot>
</table>

<!-- FORM -->
<div id="input-container">
<button id="cancel">Cancel</button>

<div id="steps-container">
<div class="steps-wrapper">

<div class="step">
    <input id="date" type="date">
    <button class="next" onclick="showStep(1)">Next</button>
</div>

<div class="step">
    <input id="details" placeholder="Transaction details">
    <button class="prev" onclick="showStep(0)">Previous</button>
    <button class="next" onclick="showStep(2)">Next</button>
</div>

<div class="step">
    <input id="amount" type="number" step="0.01" placeholder="Amount">
    <select id="type">
        <option value="debit">Debit</option>
        <option value="credit">Credit</option>
    </select>
    <button class="prev" onclick="showStep(1)">Previous</button>
    <button id="submit">Save</button>
</div>

</div>
</div>
</div>

<button id="add-btn">+ Add Transaction</button>

<script>
/* ===== PWA (SAFE) ===== */
if (
  "serviceWorker" in navigator &&
  (location.protocol === "http:" || location.protocol === "https:")
) {
  navigator.serviceWorker.register("sw.js");
}

/* ===== DATA ===== */
let entries = JSON.parse(localStorage.getItem("entries")) || [];
let editIndex = null;

const body = document.getElementById("table-body");
const totalDebitEl = document.getElementById("total-debit");
const totalCreditEl = document.getElementById("total-credit");

function render() {
    body.innerHTML = "";
    let debit = 0, credit = 0;

    entries.forEach((e, i) => {
        body.innerHTML += `
        <tr>
            <td>${e.date}</td>
            <td>${e.details}</td>
            <td>${e.type === "debit" ? e.amount : ""}</td>
            <td>${e.type === "credit" ? e.amount : ""}</td>
            <td>
                <button class="edit" onclick="editEntry(${i})">Edit</button>
                <button class="delete" onclick="deleteEntry(${i})">Delete</button>
            </td>
        </tr>
        `;

        if (e.type === "debit") debit += Number(e.amount);
        else credit += Number(e.amount);
    });

    totalDebitEl.textContent = debit.toFixed(2);
    totalCreditEl.textContent = credit.toFixed(2);

    localStorage.setItem("entries", JSON.stringify(entries));
}

render();

/* ===== FORM LOGIC ===== */
const container = document.getElementById("input-container");
const addBtn = document.getElementById("add-btn");
const wrapper = document.querySelector(".steps-wrapper");

function showStep(i) {
    wrapper.style.transform = `translateX(-${i * 100}%)`;
}

addBtn.onclick = () => {
    container.style.display = "block";
    addBtn.style.display = "none";
    editIndex = null;
    showStep(0);
};

document.getElementById("cancel").onclick = () => {
    container.style.display = "none";
    addBtn.style.display = "block";
};

document.getElementById("submit").onclick = () => {
    if (!date.value || !details.value || !amount.value) {
        alert("Please fill all fields");
        return;
    }

    const entry = {
        date: date.value,
        details: details.value,
        amount: Number(amount.value).toFixed(2),
        type: type.value
    };

    if (editIndex !== null) {
        entries[editIndex] = entry;
    } else {
        entries.push(entry);
    }

    date.value = "";
    details.value = "";
    amount.value = "";
    type.value = "debit";

    container.style.display = "none";
    addBtn.style.display = "block";
    render();
};

/* ===== EDIT / DELETE ===== */
function editEntry(i) {
    const e = entries[i];
    date.value = e.date;
    details.value = e.details;
    amount.value = e.amount;
    type.value = e.type;
    editIndex = i;

    container.style.display = "block";
    addBtn.style.display = "none";
    showStep(0);
}

function deleteEntry(i) {
    if (confirm("Delete this entry?")) {
        entries.splice(i, 1);
        render();
    }
}
</script>

</body>
</html>